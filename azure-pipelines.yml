trigger:
- main

pool:
  name: self-hosted-pool

stages:
- stage: Deploy
  displayName: Deploy to AKS
  jobs:
  - job: DeployApp
    displayName: Deploy Application
    steps:

    - checkout: self

    - script: |
        echo "System.DefaultWorkingDirectory:"
        echo $(System.DefaultWorkingDirectory)
        echo "Listing root directory:"
        dir $(System.DefaultWorkingDirectory)
        echo "Listing k8s directory:"
        dir $(System.DefaultWorkingDirectory)\k8s
      displayName: Debug repo structure

    - task: KubernetesManifest@1
      displayName: Deploy to AKS
      inputs:
        action: deploy
        kubernetesServiceConnection: aks-connection
        namespace: default
        manifests: |
          $(System.DefaultWorkingDirectory)/k8s/deployment.yaml
          $(System.DefaultWorkingDirectory)/k8s/service.yaml
