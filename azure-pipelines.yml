trigger:
- main

resources:
- repo: self

pool:
  name: self-hosted-pool

variables:
  kubernetesNamespace: default

stages:
- stage: Deploy
  displayName: Deploy to AKS
  jobs:
  - job: DeployApp
    displayName: Deploy Application to AKS
    steps:

    # 1️⃣ Checkout source code
    - checkout: self

    # 2️⃣ Debug step (VERY IMPORTANT for learning)
    - script: |
        echo "Working directory:"
        echo $(System.DefaultWorkingDirectory)
        echo "Listing files:"
        dir $(System.DefaultWorkingDirectory)
        echo "Listing k8s folder:"
        dir $(System.DefaultWorkingDirectory)\k8s
      displayName: Debug: show repo structure
      condition: succeeded()

    # 3️⃣ Deploy Kubernetes manifests
    - task: KubernetesManifest@1
      displayName: Deploy to AKS
      inputs:
        action: deploy
        kubernetesServiceConnection: aks-connection
        namespace: $(kubernetesNamespace)
        manifests: |
          $(System.DefaultWorkingDirectory)/k8s/deployment.yaml
          $(System.DefaultWorkingDirectory)/k8s/service.yaml
